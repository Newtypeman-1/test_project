<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>Help DOC - 회원가입</title>
<style>
	.valid{
		color: blue;
	}
	.invalid{
		color: red;
	}
	.msg{
		border: 1px solid black;
		width: 200px;
	}
</style>
</head>
<body>
	<th:block th:include="common/header"></th:block>
	<main class="main">
		<section class="section">
			<div class="title">회원가입</div>
			<form action="/member/register" method="post">
				<div class="input">
					<div class="input-name">
						<label for="memberId">아이디*</label>
						<span id="idCheckMsg"></span>
					</div>
					<div class="input-item">
						<input type="text" class="essen" name="memberId" id="memberId">
						<button type="button" class="idCheck">중복체크</button>
					</div>
				</div>
				<div class="input">
					<div class="input-name">
						<label for="memberPw">비밀번호*</label>
						<span id="pwCheckMsg"></span>
					</div>
					<div class="input-item">
						<input type="text" class="essen" name="memberPw" id="memberPw">
					</div>
				</div>
				<div class="msg">
		            <div>8글자 이상 12글자 이하</div>
		            <div>알파벳 대문자 포함</div>
		            <div>알파벳 소문자 포함</div>
		            <div>숫자 포함</div>
		            <div>특수문자 포함(!,@,#,$,%)</div>
		        </div>
				<div class="input">
					<div class="input-name">
						<label for="memberPwRe">비밀번호 확인</label>
						<span id="pwReCheckMsg"></span>
					</div>
					<div class="input-item">
						<input type="text" class="essen" name="memberPwRe" id="memberPwRe">
					</div>
				</div>
				<div class="input">
					<div class="input-name">
						<label for="memberPhone">전화번호*</label>
						<span id="phoneCheckMsg"></span>
					</div>
					<div class="input-item">
						<input type="text" class="essen" name="memberPhone" id="memberPhone">
					</div>
				</div>
				<div class="input">
					<div class="input-name">
						<label for="memberEmail">이메일*</label>
					</div>
					<div class="input-item">
						<input type="text" class="essen" name="memberEmail" id="memberEmail">
						@
						<input type="text" class="essen" name="com1" id="com1">
						<select name="com2" id="com2">
							<option value="">직접입력</option>
							<option value="naver.com">naver.com</option>
							<option value="gmail.com">gmail.com</option>
							<option value="daum.net">daum.net</option>
						</select>
						<button type="button" class="emailCheck">인증문자 전송</button>
					</div>
					<div class="input-item emailToggle" style="display: none;">
						<input type="text" class="essen" name="memberAuth" id="memberAuth">
						<button type="button" class="emailAuth">인증 확인</button>
						<span id="time-zone"></span>
						<span id="authMsg"></span>
					</div>
				</div>
				<div class="input">
					<div class="input-name">
						<label for="memberAddr">주소</label>
					</div>
					<div class="input-item">
						<input type="text" name="memberAddr" id="memberAddr">
					</div>
				</div>
				<div class="input">
					<div class="input-name">
						<label for="memberGender">성별*</label>
					</div>
					<div class="input-item essen">
						<input type="radio" name="memberGender" id="man" value="남">
						<label for="man">남자</label>
						<input type="radio" name="memberGender" id="woman" value="여">
						<label for="woman">여자</label>
					</div>
				</div>
				<div class="input">
					<div class="input-name">
						<span for="agree">약관*</span>
					</div>
					<div>
						<input type="text" readonly>
					</div>
					<div class="input-item">
						<input type="checkbox" class="essen" name="agree1" id="agree1">
						<label for="agree">동의</label>
					</div>
					<div>
						<input type="text" readonly>
					</div>
					<div class="input-item">
						<input type="checkbox" class="essen" name="agree2" id="agree2">
						<label for="agree">동의</label>
					</div>
					<div class="input-item">
						<input type="checkbox" name="agree3" id="agree3">
						<label for="agree">모든 약관에 동의</label>
					</div>
				</div>
				<div class="input">
					<div class="input-item">
						<button type="submit" class="regist">회원가입</button>
						<button type="button"><a href="/">취소</a></button>
					</div>
				</div>
			</form>
		</section>
	</main>
	<script>
		$(window).on("load", function(){
			$(".regist").prop("disabled", true);
			$(".msg").hide();
		});
		
		//아이디 조건
		$(".idCheck").on("click", function(){
			const memberId = $("#memberId").val();
			const icm = $("#idCheckMsg");
			icm.removeClass("invalid").removeClass("valid").text("");
			$.ajax({
				url: "/member/idCheck",
				type: "get",
				data: {memberId: memberId},
				success: function(e){
					console.log(e);
					if(e === 1){
						icm.text("사용 가능한 아이디 입니다.")
						icm.addClass("valid");
					}else {
						icm.text("사용 할 수 없는 아이디 입니다.")
						icm.addClass("invalid");
					}
				},
				error: function(){
					console.log("에러");
				}
			});
		});
		
		$("#com2").on("change", function(){
			const it = $("#com2").val();
			const com = $("#com1").val(it);
		});
		//이메일 조건 1
		let mailCode = null;
		$(".emailCheck").on("click", function(){
			const email1 = $("#memberEmail").val();
			const email2 = $("#com1").val();
			const memberEmail = email1+"@"+email2;
			if(email1 !== "" && email2 !== ""){
				$.ajax({
					url: "/member/sendCode",
					data: {memberEmail: memberEmail},
					success: function(data){
						mailCode = data;
						$(".emailToggle").show();
						authTime();
					}
				});
			}
		});
		//이메일 조건 2
		$(".emailAuth").on("click", function(){
			const memberAuth = $("#memberAuth").val();
			let authMsg = $("#authMsg");
			authMsg.removeClass("invalid").removeClass("valid").text("");
			if(memberAuth === mailCode){
				window.clearInterval(intervalid);
				mailCode = null;
				authMsg.addClass("valid").text("인증되었습니다.");
				
				$("#memberEmail").prop("readonly", true);
				$("#memberAuth").prop("readonly", true);
				$("#com1").prop("readonly", true);
				$("#com2").prop("disabled", true);
				$(".emailAuth").prop("disabled", true);
				$(".emailCheck").prop("disabled", true);
				$("#time-zone").remove();
			}else {
				authMsg.addClass("invalid").text("인증번호가 다릅니다.");
			}
		});
		let intervalid = null;
		function authTime(){
			$("#time-zone").html("<span id='min'>3</span> : <span id='sec'>00</span>");
			
			intervalid = window.setInterval(function(){
				const min = $("#min").text();
				const sec = $("#sec").text();
				if(sec === "00"){
					if(min === "0"){
						window.clearInterval(intervalid);
						mailCode = null;
						$("#authMsg").text("인증시간이 만료되었습니다.");
						$("#authMsg").css("color","red");
					}else{
						const newMin = Number(min) -1;
						$("#min").text(newMin);
						$("#sec").text(59);
					}
				}else{
					const newSec = Number(sec) -1;
					if(newSec < 10){
						$("#sec").text("0"+newSec);
					}else{
						$("#sec").text(newSec);
					}
				}
			},1000);
		};
		
		$("#memberPw").on("keyup", function(){
		    const pwValue = $("#memberPw").val();
		    const regArr = [
		        /^.{8,12}$/,
		        /[A-Z]/,
		        /[a-z]/,
		        /[0-9]/,
		        /[!@#$%]/
		    ];
		    for(let i=0; i<regArr.length; i++){
		        const check = regArr[i].test(pwValue);
		        if(check){
		            $(".msg>div").eq(i).addClass("valid");
		        }else{
		            $(".msg>div").eq(i).removeClass("valid");
		        }
		    }
		});
		let pwMsg = $("#pwCheckMsg");
		$("#memberPw").on("focus", function(){
			$(".msg").show();
		});
		//비밀번호 조건
		$("#memberPw").on("focusout", function(){
			const eq1 = $(".msg>div").eq(1);
			const eq2 = $(".msg>div").eq(2);
			const eq3 = $(".msg>div").eq(3);
			const eq4 = $(".msg>div").eq(4);
			const eq5 = $(".msg>div").eq(5);
			if(eq1.hasClass("valid") && eq2.hasClass("valid") && eq3.hasClass("valid") && eq4.hasClass("valid") && eq5.hasClass("valid")){
				pwMsg.removeClass("invalid").text("");
				pwMsg.addClass("valid").text("올바른 비밀번호 입니다.");
			}else {
				pwMsg.removeClass("valid").text("");
				pwMsg.addClass("invalid").text("비밀번호 조건을 확인해 주세요.");
			}
			$(".msg").hide();
		});
		//비밀번호 확인 조건
		$("#memberPwRe").on("focusout", function(){
			const pwV = $("#memberPw").val();
			const pwReV = $("#memberPwRe").val();
			const pwReMsg = $("#pwReCheckMsg");
			if(pwV === pwReV && pwReV !== ""){
				pwReMsg.removeClass("invalid");
				pwReMsg.addClass("valid").text("비밀번호와 일치합니다.");
			}else {
				pwReMsg.removeClass("valid");
				pwReMsg.addClass("invalid").text("비밀번호와 일치해야 합니다.");
			}
		});
		$("#memberPhone").on("focusout", function(){
			const phoneV = $("memberPhone").val();
			const phoneMsg = $("#phoneCheckMsg");
			const regExp = /^01([0|1|6|7|8|9]?)-?([0-9]{3,4})-?([0-9]{4})$/;
			if(phoneV === ""){
				phoneMsg.removeClass("valid").text("");
				phoneMsg.addClass("invalid").text("전화번호를 입력해주세요.");
			}else if(!regExp.test(phoneV)){
				phoneMsg.removeClass("valid").text("");
				phoneMsg.addClass("invalid").text("올바른 전화번호를 입력해주세요.");
			}else {
				phoneMsg.removeClass("invalid").text("");
				phoneMsg.addClass("valid").text("완료되었습니다.");
			}
		});
	</script>
	<th:block th:include="common/footer"></th:block>
</body>
</html>